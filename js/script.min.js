var materialKanban=function(){"use strict";var m=function(a){if(null===a)return null;if(void 0!==a){if("object"==typeof a)try{a=JSON.stringify(a)}catch(e){}try{return apex.util.escapeHTML(String(a))}catch(e){return(a=String(a)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")}}},c={start:function(a){try{apex.util.showSpinner($(a))}catch(e){var r=$("<span></span>");r.attr("id","loader"+a),r.addClass("ct-loader fa-stack fa-3x");var n=$("<i></i>");n.addClass("fa fa-circle fa-stack-2x"),n.css("color","rgba(121,121,121,0.6)");var t=$("<i></i>");t.addClass("fa fa-refresh fa-spin fa-inverse fa-stack-1x"),t.css("animation-duration","1.8s"),r.append(n),r.append(t),$(a).append(r)}},stop:function(e){$(e+" > .u-Processing").remove(),$(e+" > .ct-loader").remove()}},k=function(a,r,e){null==e&&(e=!0);var n={};if("string"==typeof r)try{r=JSON.parse(r)}catch(e){console.error("Error while try to parse udConfigJSON. Please check your Config JSON. Standard Config will be used."),console.error(e),console.error(r)}else n=r;try{n=$.extend(e,[],a,r)}catch(e){console.error("Error while try to merge udConfigJSON into Standard JSON if any attribute is missing. Please check your Config JSON. Standard Config will be used."),console.error(e),n=a,console.error(n)}return n},x={show:function(e,a){var r=$("<div></div>").css("margin","12px").css("text-align","center").css("padding","64px 0").addClass("nodatafoundmessage"),n=$("<div></div>"),t=$("<span></span>").addClass("fa").addClass("fa-search").addClass("fa-2x").css("height","32px").css("width","32px").css("color","#D0D0D0").css("margin-bottom","16px");n.append(t);var o=$("<span></span>").text(a).css("display","block").css("color","#707070").css("font-size","12px");r.append(n).append(o),$(e).append(r)},hide:function(e){$(e).children(".nodatafoundmessage").remove()}},D=function(e,r){var n=new Map;return e.forEach(function(e){var a=r(e);n.has(a)?n.get(a).push(e):n.set(a,[e])}),n};return{initialize:function(e,O,r,a,p,n,C,o,d){var t,s,u={},L=(u=k({refresh:0,staticColumns:[{COLUMN_ID:"1",COLUMN_TITLE:"To Do",COLUMN_ICON:"fa-calendar"},{COLUMN_ID:"2",COLUMN_TITLE:"In Progress",COLUMN_ICON:"fa-wrench"},{COLUMN_ID:"3",COLUMN_TITLE:"Done",COLUMN_ICON:"fa-check"}],dynamicColumns:!1,groupExtension:!1,groupColWidth:6,allowDragItemsBetweenGroups:!1,groupCollapsible:!1,printDataToConsole:!1},a,!1)).staticColumns,g=null,I=null,_=null,f=null,N=0,v=100,E=$("#"+e);if(0<E.length){t=E,(s=$("<div></div>")).addClass("s-g-container"),s.css("min-height","170px"),t.append(s),f=s,i();try{apex.jQuery("#"+n).bind("apexrefresh",function(){0==f.children("span").length&&(I&&I.destroy(),_&&_.destroy(),i())})}catch(e){console.log("Can't bind refresh event on "+n+". Apex is missing"),console.log(e)}0<u.refresh&&setInterval(function(){0==f.children("span").length&&(I&&I.destroy(),_&&_.destroy(),i())},1e3*u.refresh)}else console.log("Can't find parentID: "+e);function i(){if(O)c.start(f),apex.server.plugin(O,{pageItems:p,x01:"getData"},{success:function(e){E.trigger("materialkanbandataloaded"),l(e),E.trigger("materialkanbandatarendered")},error:function(e){f.empty(),console.log(e.responseText)},dataType:"json"});else try{c.start(f),setTimeout(function(){l(dataJSON)},500)}catch(e){console.log("need data json"),console.log(e)}}function l(e){var n,t,a,s,i,l,c;u.printDataToConsole&&(console.log(JSON.stringify(e)),console.log(e)),g=e.row,f.empty(),u.dynamicColumns&&(n=[],D(e.row,function(e){return e.COLUMN_ID}).forEach(function(e,a,r){a&&n.push(e[0])}),L=n),$.each(L,function(e,a){!1!==C&&(a.COLUMN_ID=m(a.COLUMN_ID),a.COLUMN_TITLE=m(a.COLUMN_TITLE),a.COLUMN_ICON=m(a.COLUMN_ICON),a.COLUMN_ICON_COLOR=m(a.COLUMN_ICON_COLOR),a.COLUMN_HEADER_STYLE=m(a.COLUMN_HEADER_STYLE),a.COLUMN_COLOR=m(a.COLUMN_COLOR)),null==a.COLUMN_COLOR&&(a.COLUMN_COLOR="hsl("+46*e%350+", 55%, 60%)"),a.COLUMN_INDEX=a.COLUMN_INDEX?a.COLUMN_INDEX:e}),L&&0<L.length?(N=u.groupExtension?100/(12*L.length/u.groupColWidth+1):0,v=(100-N)/L.length,N=Math.floor(100*N)/100,v=Math.floor(100*v)/100,function(e){var o=h(e);{var d;o.addClass("kb-row"),u.groupExtension&&((d=$("<div></div>")).addClass("kb-col kb-col-header"),d.attr("style","width:"+N+"%"),o.append(d))}$.each(L,function(e,a){(d=$("<div></div>")).addClass("kb-col kb-col-header"),d.attr("style","width:"+v+"%"),d.attr("id",a.COLUMN_ID);var r=$("<div></div>");r.addClass("kb-col-header-content");var n="border-top-color: "+a.COLUMN_COLOR+";";r.attr("style",a.COLUMN_HEADER_STYLE||n);var t=null!=a.COLUMN_TITLE?a.COLUMN_TITLE:"";r.append('<p class="title">'+t+"</p>"),d.append(r),o.append(d)})}(f),(t=h(f)).addClass("kb-group-container"),e.row&&0<e.row.length?(D(e.row,function(e){return u.groupExtension?e.GROUP_ID:1}).forEach(function(r,e,a){var n;e&&((n=h(t)).addClass("kb-row"),n.attr("groupid",e),u.groupExtension&&function(e,a){!1!==C&&(a.GROUP_ID=m(a.GROUP_ID),a.GROUP_ICON=m(a.GROUP_ICON),a.GROUP_ICON_COLOR=m(a.GROUP_ICON_COLOR),a.GROUP_HEADER_STYLE=m(a.GROUP_HEADER_STYLE),a.GROUP_TITLE=m(a.GROUP_TITLE),a.GROUP_FOOTER=m(a.GROUP_FOOTER));var r=$("<div></div>");r.addClass("kb-col kb-group-region"),r.attr("style","width:"+N+"%"),e.append(r);var n=R(r,{isGroupCard:!0,ID:a.GROUP_ID,ICON:a.GROUP_ICON,ICON_COLOR:a.GROUP_ICON_COLOR,HEADER_STYLE:a.GROUP_HEADER_STYLE,TITLE:a.GROUP_TITLE,FOOTER:a.GROUP_FOOTER,LINK:a.GROUP_LINK});{var t,o,d,s;n.addClass("kb-group-card"),u.groupCollapsible&&((t=$("<i></i>")).addClass("fa fa-chevron-down"),(o=$("<div></div>")).addClass("kb-collapsable kb-collapse"),o.append(t),$(n.find(".card-header")[0]).before(o),(d=$("<i></i>")).addClass("fa fa-chevron-up"),(s=$("<div></div>")).addClass("kb-collapsable kb-expand"),s.append(d),$(n.find(".card-header")[0]).before(s),s.attr("style","display:none"))}}(n,r[0]),$.each(L,function(e,a){!function(e,a,r){var n=$("<div></div>");n.addClass("kb-col kb-item-region"),n.attr("style","width:"+v+"%"),e.append(n);var t=$("<div></div>");t.addClass("kb-col-content");var o="border-left-color: "+r.COLUMN_COLOR+";";t.attr("style",r.COLUMN_HEADER_STYLE||o),n.append(t);var d=$("<div></div>");d.addClass("kb-col-inner-header");var s=null!=r.COLUMN_TITLE?r.COLUMN_TITLE:"";d.append('<p class="title">'+s+"</p>"),t.append(d);var i=$("<div></div>");{var l;i.addClass("kb-item-container"),i.attr("columnid",r.COLUMN_ID),t.append(i),0==r.COLUMN_INDEX&&0<(l=a.filter(function(e){return e.GROUP_NEW_ITEM_LINK})).length&&(i.addClass("kb-item-container-with-new-card"),b(t,l[0].GROUP_NEW_ITEM_LINK))}!function(e,r,n){e&&0<e.length&&$.each(e,function(e,a){!1!==C&&(a.ID=m(a.ID),a.ICON=m(a.ICON),a.ICON_COLOR=m(a.ICON_COLOR),a.HEADER_STYLE=m(a.HEADER_STYLE),a.TITLE=m(a.TITLE),a.FOOTER=m(a.FOOTER),a.FILL_BG_COLOR=m(a.FILL_BG_COLOR),a.FILL_BG_WIDTH=m(a.FILL_BG_WIDTH)),R(r,{isGroupCard:!1,ID:a.ID,ICON:a.ICON,ICON_COLOR:a.ICON_COLOR,HEADER_STYLE:a.HEADER_STYLE,TITLE:a.TITLE,FOOTER:a.FOOTER,LINK:a.LINK,FILL_BG_COLOR:a.FILL_BG_COLOR,FILL_BG_WIDTH:a.FILL_BG_WIDTH},n)})}(a.filter(function(e){return e.COLUMN_ID==r.COLUMN_ID&&e.ID}),i,r)}(n,r,a)}),u.groupExtension&&u.groupCollapsible&&(n.find(".kb-collapsable").click(function(){U(n,!0)}),1===r[0].GROUP_COLLAPESED&&U(n,!1)))}),a=e.row.filter(function(e){return e.NEW_GROUP_LINK}),u.groupExtension&&0<a.length&&function(e,a){var r=h(e);r.addClass("kb-row");var e=r,n=$("<div></div>");n.addClass("kb-group-region kb-new-group-region"),e.append(n),b(n,a)}(f,a[0].NEW_GROUP_LINK),o&&(l=0,c=null,I=dragula($(E.find(".kb-item-container")).toArray(),{direction:"vertical",accepts:function(e,a,r,n){return!!u.allowDragItemsBetweenGroups||$(r).closest(".kb-row").attr("groupid")==$(a).closest(".kb-row").attr("groupid")}}),$(".kb-item-container > .kb-card").each(function(e,a){$(a).addClass("kb-card-draggable"),a.addEventListener("touchmove",function(e){e.preventDefault()})}),I.on("drag",function(e,a){var r=$(e),n=$(a);l=r.index();var t=r.next();c=0<t.length?$(t[0]):null;var o={itemId:r.attr("itemid"),sourceGroupId:n.closest(".kb-row").attr("groupid"),sourceColumnId:n.attr("columnid"),sourceItemIndex:l};E.trigger("materialkanbandrag",[o])}),I.on("drop",function(e,a,r,n){var t=$(e),o=$(a),d=$(r),s={itemId:t.attr("itemid"),sourceGroupId:d.closest(".kb-row").attr("groupid"),sourceColumnId:d.attr("columnid"),sourceItemIndex:l,targetGroupId:o.closest(".kb-row").attr("groupid"),targetColumnId:o.attr("columnid"),targetItemIndex:t.index()};try{apex.server.plugin(O,{pageItems:p,x01:"moveItem",x02:s.itemId,x03:s.sourceGroupId,x04:s.sourceColumnId,x05:s.sourceItemIndex,x06:s.targetGroupId,x07:s.targetColumnId,x08:s.targetItemIndex},{success:function(e){},error:function(e){c?t.insertBefore(c):d.append(t),T(t,d.attr("columnid")),console.error(e.responseText),E.trigger("materialkanbandroperror",[s])},dataType:"json"})}catch(e){console.log("Can't call server on drag'n drop event. Apex is missing"),console.log(e)}T(t,o.attr("columnid")),E.trigger("materialkanbandrop",[s])}),u.groupExtension&&d&&(s=0,i=null,_=dragula($(E.find(".kb-group-container")).toArray(),{direction:"vertical",moves:function(e,a,r){return 0<$(r).closest(".kb-group-card").length}}),$(".kb-group-region > .kb-card").each(function(e,a){$(a).addClass("kb-card-draggable"),a.addEventListener("touchmove",function(e){e.preventDefault()})}),_.on("drag",function(e,a){var r=$(e);s=r.index();var n=r.next();i=0<n.length?$(n[0]):null;var t={groupId:r.attr("groupid"),sourceGroupIndex:s};E.trigger("materialkanbandraggroup",[t])}),_.on("drop",function(e,a,r,n){var t=$(e),o=($(a),$(r)),d={groupId:t.attr("groupid"),sourceGroupIndex:s,targetGroupIndex:t.index()};try{apex.server.plugin(O,{pageItems:p,x01:"moveGroup",x02:d.groupId,x03:d.sourceGroupIndex,x04:d.targetGroupIndex},{success:function(e){},error:function(e){i?t.insertBefore(i):o.append(t),console.error(e.responseText),E.trigger("materialkanbandroperror",[d])},dataType:"json"})}catch(e){console.log("Can't call server on drag'n drop event. Apex is missing"),console.log(e)}E.trigger("materialkanbandropgroup",[d])})))):(t.css("min-height",""),x.show(t,r))):console.log("No columns defined!")}function h(e){var a=$("<div></div>");return a.addClass("s-g-row"),e.append(a),a}function R(e,a,r){var n,t=$("<div></div>");t.addClass("kb-card"),t.attr("itemid",a.ID),(a.FILL_BG_COLOR||a.FILL_BG_WIDTH)&&((n=$("<div></div>")).addClass("card-bg-fillable"),a.FILL_BG_COLOR?n.css("background-color",a.FILL_BG_COLOR):r&&r.COLUMN_COLOR&&(n.css("background-color",r.COLUMN_COLOR),n.css("opacity","0.2")),a.FILL_BG_WIDTH?n.css("width",a.FILL_BG_WIDTH+"%"):n.css("width","100%"),t.append(n));var o,d=$("<div></div>");d.addClass("card-header"),"none"!==a.ICON&&(a.ICON||r&&r.COLUMN_ICON)&&((o=$("<i></i>")).addClass("fa "+(a.ICON||r.COLUMN_ICON)),(a.ICON_COLOR&&0<a.ICON_COLOR.length||r&&r.COLUMN_ICON_COLOR&&0<r.COLUMN_ICON_COLOR.length)&&o.attr("style","color:"+(a.ICON_COLOR||r.COLUMN_ICON_COLOR)),d.append(o)),a.HEADER_STYLE?d.attr("style",a.HEADER_STYLE):r&&r.COLUMN_COLOR&&d.attr("style","background:"+r.COLUMN_COLOR),t.append(d);var s=$("<div></div>");s.addClass("card-content");var i,l,c,O=a.TITLE?a.TITLE:"";return s.append('<p class="title">'+O+"</p>"),a.LINK?((i=$("<a></a>")).attr("href",a.LINK),i.append(s),t.append(i)):t.append(s),a.FOOTER&&((l=$("<div></div>")).addClass("card-footer"),(c=$("<div></div>")).append(a.FOOTER),l.append(c),t.append(l)),e.append(t),t}function b(e,a){var r=$("<div></div>");r.addClass("kb-new-card");var n=$("<i></i>");n.addClass("fa fa-plus"),r.append(n);var t=$("<a></a>");t.attr("href",a),t.append(r);var o=$("<div></div>");o.addClass("kb-new-item-region"),o.append(t),e.append(o)}function T(e,a){var r=e.attr("itemid"),n=g.find(function(e){return e.ID==r}),t=L.find(function(e){return e.COLUMN_ID==a}),o=e.find(".card-header"),d=o.find("i");(n&&n.ICON||t&&t.COLUMN_ICON)&&(d.removeClass().addClass("fa "+(n.ICON||t.COLUMN_ICON)),(n.ICON_COLOR&&0<n.ICON_COLOR.length||t&&t.COLUMN_ICON_COLOR&&0<t.COLUMN_ICON_COLOR.length)&&d.attr("style","color:"+(n.ICON_COLOR||t.COLUMN_ICON_COLOR))),!n.HEADER_STYLE&&t&&t.COLUMN_COLOR&&o.attr("style","background:"+t.COLUMN_COLOR)}function U(e,a){e.find(".kb-collapsable").toggle(),e.find(".card-footer").toggle(),e.find(".kb-item-region").toggle();var r,n=e.find(".kb-group-region");n.toggleClass("kb-collapsed"),a&&(r={groupId:e.attr("groupid"),collapsed:n.hasClass("kb-collapsed")},E.trigger("materialkanbangroupcollapsed",[r]))}}}}();